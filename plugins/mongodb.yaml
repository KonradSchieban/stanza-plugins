version: 0.0.5
title: MongoDB
description: Log parser for MongoDB
parameters:
  - name: log_path
    label: Path
    description: The path of the log file
    type: string
    default: "/var/log/mongodb/mongodb.log"
  - name: start_at
    label: Start At
    description: Start reading file from 'beginning' or 'end'
    type: enum
    valid_values:
     - beginning
     - end
    default: end

# Set Defaults
# {{$log_path := default "/var/log/mongodb/mongodb.log" .log_path}}
# {{$start_at := default "end" .start_at}}

# Pipeline Template
pipeline:
  - id: file_input
    type: file_input
    include:
      - {{ $log_path }}
    start_at: {{ $start_at }}
    labels:
      log_type: 'mongodb'
      plugin_id: {{ .id }}
    output: regex_parser

  - id: regex_parser
    type: regex_parser
    regex: '^(?P<timestamp>\S+)\s+(?P<severity>\w+)\s+(?P<component>[\w-]+)\s+\[(?P<context>\S+)\]\s+(?P<message>.*)$'
    timestamp:
      parse_from: timestamp
      #2019-02-06T09:22:43.967-0500
      layout: '%Y-%m-%dT%H:%M:%S.%f%z'
    severity:
      parse_from: severity
      mapping:
        critical: F
        error: E
        warning: W
        info: I
        debug:
          - D
          - D1
          - D2
          - D3
          - D4
          - D5
    output: {{ .output }}

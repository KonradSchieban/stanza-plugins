# Plugin Info
version: 0.0.2
title: Kubernetes Events
description: Kubernetes Events Parser
parameters:
  namespaces:
    label: Namespaces
    description: An array of namespaces. Defaults to use all namespaces.
    type: strings
    default: []

# Pipeline Template
pipeline:
  - type: k8s_event_input
    namespaces:
{{ range $i, $ns := .namespaces  }}
      - {{ $ns }}
{{ end }}
    labels:
      plugin_id: {{ .id }}
      log_type: "k8s.events"

  # Add metadata like annotations and daemonset name if there is a pod name
  - type: router
    routes:
      - expr: '$resource["k8s.pod.name"] != ""'
        output: k8s_metadata_decorator
      - expr: "true"
        output: severity_parser

  - type: k8s_metadata_decorator

  - type: severity_parser
    preset: none
    parse_from: $record.reason
    preserve: true
    mapping:
      info:
        - Created
        - SandboxChanged
        - NodeAllocatableEnforced
        - SuccessfulMountVolume
        - SuccessfulAttachVolume
        - FileSystemResizeSuccessful
        - VolumeResizeSuccessful
        - Starting
        - NodeReady
        - Pulling
        - Pulled
        - Started
        - Killing
        - NodeSchedulable
        - RegisteredNode
      warning:
        - AlreadyMountedVolume
        - ContainerGCFailed
        - ExceededGracePeriod
        - Evicted
        - FailedCreatePodSandBox
        - FailedNodeAllocatableEnforcement
        - FailedPostStartHook
        - FailedPreStopHook
        - FailedSync
        - FailedValidation
        - FailedKillPod
        - HostPortConflict
        - ImageGCFailed
        - InspectFailed
        - InvalidDiskCapacity
        - NetworkNotReady
        - Preempting
        - ProbeWarning
        - Rebooted
        - Unhealthy
      error:
        - BackOff
        - FailedCreatePodContainer
        - FailedMountOnFilesystemMismatch
        - FailedPodSandBoxStatus
        - FailedScheduling
        - FileSystemResizeFailed
        - FreeDiskSpaceFailed
        - KubeletSetupFailed
        - VolumeResizeFailed
      critical:
        - ErrImagePull
        - ErrImageNeverPull
        - Failed
        - FailedAttachVolume
        - FailedMapVolume
        - FailedMount
        - NodeNotReady
        - NodeNotSchedulable
    output: {{ .output }}
